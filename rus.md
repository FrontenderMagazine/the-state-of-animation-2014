# Состояние веб-анимации в 2014 году

Эру после Flash вряд ли можно назвать свободной от анимации. Анимации на CSS
быстро стали краеугольным камнем дружественных к пользователю интерфейсов на
мобильных устройствах и настольных компьютерах, и библиотеки на JavaScript уже
осуществляют управление сложно взаимодействующими анимациями. Вследствие такого
большого количества обсуждений в духе «анимации на CSS против JavaScript», новое
API, созданное специально для веб-анимаций, выходит, чтобы объединить оба
враждующих лагеря.

Это захватывающий период в мире веб-анимации, и пришло время похоронить
недопонимания и дезинформацию. В 2014, у меня был шанс поездить по миру и
поговорить об [использовании анимации в пользовательских интерфейсах и
дизайне][1]. Я встречалась и беседовала с множеством людей, которые используют и
защищает оба способа: и CSS, и JavaScript. После опроса стольких разработчиков, 
дизайнеров и представителей компаний, занимающихся разработкой браузеров, 
я бы хотела поведать историю о людях и технологиях.

То, что вы прочитаете здесь, является чисто наблюдательной и непредвзятой точкой
зрения на тему веб-анимации.


## Может быть эра Flash закончилась, но эра веб-анимации только начинается

Со времён эры Flash, стало модным думать, что анимации это не более, 
чем декорация, кричащее дополнение, зачастую безвкусное, как, например, 
тэг `blink`. Но на деле, если мы хотим показать на экране что то, 
кроме текста, анимация — наш лучший друг.

Для **дизайнеров пользовательских интерфейсов**, анимация закрепляет иерархию 
элементов и отношения между ними, структуру и причинно-следственные связи. 
[Исследования из ранних 90х][2] демонстрируют, что анимация позволяет людям 
лучше понять, что же происходит на экране. Анимации соединяют вместе состояния 
приложения и избавляют от этой работы GPU человеческого мозга — зрительную кору.

Для **разработчиков интерактива**, сложные визуальные эффекты — от инфографики
на странице со сводной информацией о проекте до видеоигр на планшете — невозможно 
представить без анимации, связующей все кусочки вместе. Если мы хотим использовать 
всё это в Интернет, то нам нужны анимации.

К сожалению мы остались позади в гонке анимированной графики. Продукты,
использующие анимацию на благо своих пользователей, ждёт успех, в то время как
их статичных или злоупотребляющих анимацией конкурентов ждёт провал. В нынешнем
состоянии, нативные приложения наголову разбивают веб. Их разработчики с самого 
начала могли использовать анимацию в своих проектах, ввести её в рабочий
процесс, и инструменты прототипирования, вроде [Flinto][3] и [Mitya][4].

Но всё ещё может обернуться иначе. Команда разработчиков Safari под iOS протолкнула
спецификации CSS-анимаций и переходов, так что веб-сайты смогли быть стилизованы
не хуже, чем приложения для iOS. Даже Google поддержал это, [поставив анимацию в
центр][5] своих рекомендаций по Material Design, позаботившись о том, что стоит
и чего не стоит делать, применяя анимацию и переходы осмысленно, с определённой
целью.

Анимация — это естественный шаг в эволюции экосистемы приложений и устройств.
Она делает цифровой мир более интуитивным и интересным для пользователей всех
возрастов. И до тех пор, пока наши девайсы разгоняют GPU, она никуда не денется.


## Анимация всего на свете

По своей сути, анимация является просто визуальным отображением скорости
изменений во времени и пространстве. Всю анимацию можно разделить на три типа:

**Статическая анимация** воспроизводится от начального положения к конечному,
без ветвлений или логики. Она может [выполнятся на одном лишь CSS][6], как
свидетельствуют [множественные анимации загрузки на CSS][7].

![Статическая анимация][Отображение статической анимации]

**Анимация с учётом состояний** в самой простой форме принимает булево значение
— [клик для раскрытия меню и клик, чтобы закрыть его][8], например —
и анимирует между двумя состояниями. В настоящее время это достигается в
JavaScript-фреймворках через применение и удаление классов, содержащих
CSS-анимацию.

![Анимация с учётом состояний][Отображение анимации с учётом состояний]

**Динамическая анимация** может иметь множество результирующих состояний в
зависимости от человеческих действий и других условий.
Она использует свою собственную логику для определения того, как происходящее
будет анимироваться и какими будут конечные положения. Это может быть
перетаскивание страницы вслед за вашими пальцами, зависящее от скорости вашего
движения, или динамическая перестройка графика, как только были получены новые 
данные. Этот тип анимаций более сложный чем те, которые позволяют нам доступные 
сегодня инструменты. Для его создания не получится использовать только CSS.

![Динамическая анимация][Отображение динамической анимации]


### Больше состояний != Динамическая Анимация

Проницательный разработчик может заметить, что с достаточным количеством
состояний, CSS-анимация сильно напоминает динамическую. До определенного
момента это так. Но настоящая динамическая анимация имеет гораздо больше 
конечных состояний, чем вы можете предвидеть.

![Больше состояний != Динамическая Анимация][Сравнение типов анимации]

Просто представьте небольшую полосу загрузки. Имея отдельный класс для каждой
точки «заполненности», будет легко написать сотню строк на CSS, не упоминая,
сколько раз JavaScript затронет DOM для обновления классов и браузерной
перерисовки. Мы определённо можем написать более производительную динамическую
полосу загрузки на чистом JavaScript.

CSS анимации декларативны: не касаясь горстки псевдо-классов, таких как `:hover`
и `:target`, они не принимают контекста ни от пользователя, ни от
пользовательского окружения. Они делают только то, что автор им велел делать и
не реагируют на новые действия пользователя или изменение среды. Не существует
способа задать для CSS-анимации следующее «Если ты находишься в середине страницы,
делай это; иначе, делай то». CSS не содержит логики такого сорта.

Когда разработчики, предпочитающие использовать для решения задач CSS, 
нуждаются в логике, они часто начинают создавать классы, соответствующие 
нужным состояниям, определяя через JavaScript, когда следует применить 
тот или иной класс. Такие фреймворки, как [AngularJS][9] поддерживают 
состояния, и многие взаимодействия с UI легко к ним адаптируются, 
например к состояниям «загрузка», «открыто» или «выбрано». Кроме того,
анимации мягко деградируют в старых браузерах, а в тех, которые поддерживают
анимации и переходы, делают процесс использования интерфейса значительно более
приятным.

![Разработчик интерфейсов против разработчика интерактива][Комикс1]

Вот только разработчики интерактивных процессов с этим не согласны. 
CSS анимации зачастую слишком декларативны для реализации того, 
что они хотят. Клиенты, которые за всё платят, требуют надёжной поддержки анимации в
распространённых браузерах; так, многие из разработчиков интерактивных процессов и их
студии делают то, что делают все умные разработчики: создают трудосберегающие
библиотеки, оптимизированные под их собственные процессы. Некоторые из этих
библиотек, такие как [GSAP][10] и [Velocity][11], доступны и разрабатываются для
общественного использования. Но многие другие так никогда и не будут
опубликованы, потому что у людей и агентств, создающие их, нет времени,
денег или желания поддерживать open-source проекты.

![Про релиз][Комикс2]

Это и есть задевающая за живое история, которую я слышала раз за разом. Она
даёт повод предполагать, что множество разработчиков продолжат изобретать
колесо, если веб не совершит существенный шаг вперёд. Легко наблюдать, как
библиотеки вроде GSAP вынуждены становиться коммерческими в борьбе за выживание,
или как библиотеки вроде Velocity поддерживаются за счёт спонсоров.

![Flash властвует][Иллюстрация1]

*И Flash был великодушным диктатором,
давшим своим людям визуальную временную шкалу.*

Flash сделал великую вещь, предоставив интерактивным разработчикам и дизайнерам UI
универсальную среду, выполняющую анимации любого типа, и платформу для их
редактирования.
Но с тех пор, как 
[Стив Джобс ещё в 2010 году объявил, что iPhone никогда не будет поддерживать Flash][12],
множество бывших разработчиков на Flash тихо ушло в отставку,
забрав свои нишевые знания с собой. Сейчас, целое поколение веб-дизайнеров приходит
без знания возможностей и проблем, с которыми мы сталкиваемся лицом к лицу,
когда возрастает сложность анимации.

Но ситуация начинает меняться к лучшему.


## Web Animation API: <del>Величайший</del> API о котором вы никогда не слышали

Web Animation API — это спецификация W3C, которая устанавливает объединённый язык
для CSS и SVG анимаций, и открывает браузерный анимационный движок для использования
разработчиками. Она выполняет следующие функции:

*  предоставляет API движка анимации, которое позволит нам разрабатывать
лучшие браузерные инструменты для создания анимаций, а библиотекам —
повысить производительность;
*  позволяет (определённой) анимации выполняться в собственном потоке, уменьшая 
таким образом количество мусора;
*  поддерживает [траектории движения][13];
*  обеспечивает вызов коллбэков после проигрывания анимации;
*  заново вводит [вложенные и последовательные анимации][14], чего мы не видели
со времён Flash;
*  позволяет нам останавливать, запускать, искать, проигрывать в обратном
порядке, замедлять или ускорять воспроизведение анимации
с помощью [опций управления временем][15] и [объекта проигрывателя анимаций][16]
   
Вот
[один из примеров того, что Web Animation API может, а чистый CSS нет][17]
*(в примере в левой колонке — анимация кошки на CSS, в правой — на Web Animation
API.
Если добавить ещё по кошке в каждую колонку(кнопка «Add a Cat»), то можно
заметить,
что кошки слева бегут вразнобой, а кошки справа абсолютно синхронны
— прим.пер.)*

<p data-height="583" data-theme-id="0" data-slug-hash="zxYexJ" data-default-
tab="result" data-user="rachelnabors" class='codepen'>Посмотрите пример <a
href='http://codepen.io/rachelnabors/pen/zxYexJ/'>как работает Web Animations
API</a> от Rachel Nabors (<a
href='http://codepen.io/rachelnabors'>@rachelnabors</a>) на <a
href='http://codepen.io'>CodePen</a>.</p>

### Поддержка

Web Animation API находится в разработке уже более двух лет, и его фичи
выкатываются в ночных сборках Chrome и Firefox в течение последних 6 месяцев.
Mozilla является главной движущей силой спецификации, в то время как у команды
Chrome в приоритете реализация функционала.

[Microsoft держит API «на рассмотрении»][18] для реализации в Internet Explorer. 
В Apple, на удивление, также заняли выжидательную позицию. И мы можем лишь
фантазировать о том, когда поддержка API появится в [веб-движках, построенных
на старых форках опенсорсных браузеров][19].

Экспериментаторы, которые желают попробовать API, могут использовать
[полифил для Web Animations API][20], который заменяется на [Web Animations
Next][21] (больше про полифил и API можно узнать на [веб-сайте проекта Polymer][22]). 
Однако, для браузеров не поддерживающих API, полифил всё ещё будет менее 
производительным, чем GSAP, абсолютный чемпион среди анимационных библиотек 
написанных на JavaScript. Таким образом, это полифил не то, что разработчики
интерактивных процессов хотели бы увидеть в своих высокопроизводительных проектах.

Должно будет пройти некоторое время, прежде чем этот API начнёт поддерживаться
повсеместно. Часть производителей браузеров выжидает, желая увидеть, как
разработчики будут его использовать, и большая часть разработчиков откладывает
использование инструментов, пока они не начнут широко поддерживаться, так API
испытывает на себе проблему «курицы и яйца». Однако, во время беседы с Полом
Кинланом (Paul Kinlan) из Google на конференции Fronteers, я предположила, что
если API будет полностью поддерживаться в закрытых и монетизированных системах
для веб-приложений, вроде Google Play, разработчики смогут благополучно
использовать его в этой песочнице, пока он не достигнет зрелости и широкой
поддержки браузерами.


### Производительность

Авторы и проектировщики API надеются, что разработчики анимационных библиотек
начнут задумываться о поддержке API благодаря выгоде от его производительности.
Так как Web Animation API использует движок рендеринга CSS, мы можем ожидать
уровня производительности CSS. Анимации будут проигрываться в своём собственном
потоке до тех самых пор, пока они независимы от чего-либо в основном потоке,
например от JavaScript или разметки.

Говоря о лэйауте, рефлоу был и остаётся самым узким местом с точки зрения 
производительности. Ни CSS, ни JavaScript не могут его избежать, если конечно не
отправлять всё используя WebGL непосредственно в GPU (как некоторые доморощенные
умники, занимающиеся разработкой библиотек, собственно, и делают). Не считая
`opacity` и `transform`, анимация большинства CSS-свойств вызовет перестроение
и/или повторную отрисовку части страницы. [CSS-свойство `will-change` немного
облегчит задачу][23], позволив нам указать на что-то и сказать браузеру, «Вот,
вот эта вещь будет меняться. Сделай что нужно, чтобы изменения прошли
эффективно.» Остаётся надеяться, что пока браузеры учатся обращаться с графикой,
они переносят эти элементы на отдельный слой или иначе оптимизируют обработку
этой графики. Это первый шаг к освобождению от таких хаков как `translateZ(0)`.

Такие «хаки производительности» часто используются в качестве магического фикса
всякий раз, когда анимация проседает, но они вызывают проблемы с
производительностью, если используются бездумно. В долгосрочной перспективе
лучше всего действительно положиться на браузеры в вопросах производительности.
К счастью, разработчики браузеров борются за то, чтобы как можно меньшее
количество свойств затрагивало остальные элементы на странице, таким образом
держа их в стороне от основного потока. Для разработчиков анимационных библиотек
это означает, что Web Animation API станет выигрышным союзником в борьбе за
производительность в ближайшем будущем.


### Инструменты

Любому, кто работал с веб-анимацией, знакома тоска по соответствующим
инструментам разработки: временной шкале, инспектору свойств, хорошим
редакторам, и возможности поставить на паузу, перемотать и проинспектировать
анимацию во время отладки. Web Animation API сделает доступным движок
рендеринга CSS и разработчикам, и самим браузерным вендорам для создания таких
инструментов. [Chrome][24] и Firefox готовят соответствующий функционал для
своих инструментов разработки. API делает это возможным.


## Сообщество

Не так много людей, помимо тех, кто работает над ним, знают про Web Animation
API. Сообщество веб-стандартов жаждет получить реальные отзывы от разработчиков
интерактивных процессов и анимационных библиотек. Однако, многим разработчикам 
кажется, будто авторы находятся за каменной стеной, далеко от суровой реальности,
потребностей клиентов и уроков, полученных со времён Flash.

![08-flash-exile-opt][Иллюстрация2]

*Старого гвардейца отправили в ссылку те самые люди,
которым он когда-то служил.*

Если честно, разработчики стандартов и правда не очень-то стремятся к встрече
со своей аудиторией. Для вступления в «официальное» сообщество Web Animation
API, вам придётся приложить усилия, и пробиться в переписке с разработчиком, у
которого и так переполнена вся почта. Кроме того, вы можете попытать счастья,
подключившись к каналу в IRC — если предположить, что дизайнеры используют IRC. 
Беседа, которая должна состояться, вряд ли когда-нибудь состоится, если людей, 
которым есть что сказать, просто на ней не будет. Вендоры и авторы спецификации 
должны найти больше способов достучаться до своей аудитории, иначе существует 
риск создать API, у которого не будет аудитории совсем.

Но авторы стандарта не единственные, у кого проблемы с коммуникацией.
Как сообщество, мы можем поверхностно и скоро высмеивать те вещи, которые
кажутся нам неподходящими или не нравятся. Многие из нас вкладывают своё эго в
наши инструменты и процессы. Но эти вещи не определяют нас. То, что мы создаём
вместе, определяет нас.

*  **Разработчики анимационных библиотек**, [прочитайте спецификацию][25]. Она
длинная, но раз Джэк Дойл (Jack Doyle) из GreenSock может это сделать, сможете
и вы.

*  **Разработчики интерактивных процессов** у которых нет целого дня на чтение 
огромной спецификации, просто прочтите [readme на странице полифила][26]. Оно отлично
передаёт суть. Когда вы узнаете, что готовится, вы будете знать, что из этого
может вам пригодиться, независимо от того, будет ли это оптимизацией
производительности ваших библиотек или UI для отображения временной
шкалы в браузере.

*  **Дизайнеры**, отдавайте приоритет JavaScript в работе. Поиграйте с
полифилом, GSAP и Velocity. Узнайте, что они могут для вас сделать сверх того, 
что может CSS.

Благодаря веб-анимации, мы имеем редкий шанс отложить наше эго в сторону и
объединиться для создания инструментов с помощью которых будущие поколения дизайнеров и
разработчиков смогут создавать грандиозные вещи. Ради них, я надеюсь мы сможем.

> “Искусство бросает вызов технологиям, а технологии вдохновляют искусство.”
> 
> – Джон Лассетер (John Lasseter), CCO Pixar


## Источники

У Рэйчел Нэйборс (Rachel Nabors) есть [обновляемый список ресурсов по Web
Animation API][27]. Чтобы присоединиться к неофициальному обсуждению, поищите по
хэштэгу `#waapi` везде, где вам хотелось бы общаться.

- [Спецификация по Web Animations API][28], W3C
- [Web Animations polyfill][29] и [Web Animation Next][30] (следующее воплощение
полифила)
- Анимационная библиотека [GreenSock][10]
- [Velocity][11], более производительная замена .animate() в jQuery


### Присоединиться к обсуждению

- Официальная почтовая рассылка: [public-fx@w3.org][31], в поле темы начните с
[web-animations] …
- IRC: [irc.w3.org#webanimations][32]
- Что угодно ещё: используйте хэштэг `#waapi` и присоединяйтесь к сообществу

### Внести вклад

Люди которые имеют знакомство с C++ могут помочь [воплощать API в Firefox][33].
[Брайан Бёртлс (Brian Birtles)][34] возможно даже будет наставлять вас! Ещё Mozilla постоянно
ищет людей, готовых помочь с написанием документации на [MDN][35].

Незначительные корректировки в спецификации (грамматика, орфография,
несогласованности, и т.п.) могут быть отправлены через [пулл-реквест на GitHub][36].


### Люди в Твиттере

- Браян Биртлз ([Brian Birtles][37]), главный автор спецификации из Mozilla Japan
- Алекс Данило ([Alex Danilo][38]), соавтор из команды платформы Google
- Таб Аткинс ([Tab Atkins—Googler][39]), соавтор и контрибьютор спецификации CSS
- Джек Дойл ([Jack Doyle][40]), представитель GreenSock и GSAP
- Рейчел Наборс ([Rachel Nabors][41]), глава мозгового центра анимации в [Tin Magpie][42]




 [1]: http://www.slideshare.net/CrowChick/animation-and-the-future-of-ux-33573726
 [2]: https://smartech.gatech.edu/bitstream/handle/1853/3627/93-17.pdf
 [3]: https://www.flinto.com/
 [4]: http://www.mitya-app.com/
 [5]: http://www.google.com/design/spec/animation/authentic-motion.html
 [6]: http://codepen.io/rachelnabors/full/rCost
 [7]: http://codepen.io/collection/HtAne/
 [8]: http://tympanus.net/Development/SimpleDropDownEffects/
 [9]: https://docs.angularjs.org/api/ngAnimate
 [10]: http://greensock.com/
 [11]: http://julian.com/research/velocity/
 [12]: https://www.apple.com/hotnews/thoughts-on-flash/
 [13]: http://dirkschulze.github.io/specs/motion-1/
 [14]: https://github.com/web-animations/web-animations-js#sequencing-and-synchronizing-animations
 [15]: https://github.com/web-animations/web-animations-js#controlling-the-animation-timing
 [16]: https://github.com/web-animations/web-animations-js#playing-animations
 [17]: http://codepen.io/rachelnabors/pen/zxYexJ/
 [18]: https://status.modern.ie/webanimationsjavascriptapi?term=animations
 [19]: https://developer.amazon.com/appsandservices/solutions/platforms/webapps
 [20]: https://github.com/web-animations/web-animations-js
 [21]: https://github.com/web-animations/web-animations-next
 [22]: https://www.polymer-project.org/platform/web-animations.html
 [23]: https://dev.opera.com/articles/css-will-change-property/
 [24]: http://src.chromium.org/viewvc/blink?view=revision&revision=183847
 [25]: http://w3c.github.io/web-animations/
 [26]: https://github.com/web-animations/web-animations-js#readme
 [27]: http://rachelnabors.com/waapi/
 [28]: http://w3c.github.io/web-animations/
 [29]: https://github.com/web-animations/web-animations-js
 [30]: https://github.com/web-animations/web-animations-next
 [31]: mailto:public-fx@w3.org
 [32]: http://irc.w3.org/#webanimations
 [33]: https://developer.mozilla.org/en-US/docs/Introduction
 [34]: https://twitter.com/brianskold
 [35]: https://developer.mozilla.org/en-US/
 [36]: https://github.com/w3c/web-animations
 [37]: http://twitter.com/brianskold
 [38]: http://twitter.com/alexanderdanilo
 [39]: http://twitter.com/tabatkins
 [40]: http://twitter.com/greensock
 [41]: http://twitter.com/rachelnabors
 [42]: http://tinmagpie.com/


 [Отображение статической анимации]: img/01-static-animation-opt-ru.png
 [Отображение анимации с учётом состояний]: img/02-stateful-animation-opt-ru.png
 [Отображение динамической анимации]: img/03-dynamic-animation-opt-ru.png 
 [Сравнение типов анимации]: img/04-multi-state-vs-reactive-opt-ru.png 
 [Комикс1]: img/05-ui-vs-ixd-opt-ru.png
 [Комикс2]: img/06-client-work-opt-ru.png
 [Иллюстрация1]: img/07-flash-rule-opt.png
 [Иллюстрация2]: img/08-flash-exile-opt.png
